<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />

<!-- qunit -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-git.css" type="text/css" />
<script src="//code.jquery.com/qunit/qunit-1.14.0.js"></script>

<!-- testrunner -->
<script src="../../../js/reporter.js"></script>
<script src="../../../moxie_loader.js"></script>

<script type="text/javascript" src="../../Image/jpegs.js"></script>

<script type="text/javascript">

QUnit.config.reorder = false;
QUnit.config.testTimeout = 10000;
QUnit.config.autostart = false;

module("HTML5: Problematic JPEGs");

function onJPEGsLoaded(jpegs) {
	o.each(jpegs, function(jpeg) {
		var desc = jpeg.desc ? jpeg.path + ': ' + jpeg.desc : jpeg.path;
		test(desc, function(assert) {
			var jh = new o.JPEGHeaders(jpeg.source);
			var ep = new o.ExifParser(jh.get("app1")[0]);

			o.each(jpeg.expect, function(info, method) {
				var data = ep[method]();

				if (!data) {
					assert.ok(false, "Exif data cannot be extracted");
				}

				o.each(info, function(value, key) {
					assert.equal(data[key], value, method + ' - ' + key + ': ' + value);
				});
			});

			if (jpeg.hasThumb) {
				assert.ok(ep.thumb() !== null, "Thumb found and can be extracted.");
			}
		});
	});

	QUnit.start();
}

</script>
</head>
<body>
	<div id="qunit"></div>
    <div id="qunit-fixture" style="position: relative; top: 0 !important; left: 0 !important; width: 100%; height: 9px;"></div>
</body>
</html>
